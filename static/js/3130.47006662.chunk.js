"use strict";(self.webpackChunkn2_depot=self.webpackChunkn2_depot||[]).push([[3130],{151:(e,t,n)=>{function r(){return new Float32Array(4)}function i(e){const t=new Float32Array(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function s(e,t,n,r){const i=new Float32Array(4);return i[0]=e,i[1]=t,i[2]=n,i[3]=r,i}function o(){return r()}function a(){return s(1,1,1,1)}function l(){return s(1,0,0,0)}function c(){return s(0,1,0,0)}function d(){return s(0,0,1,0)}function u(){return s(0,0,0,1)}n.d(t,{c:()=>i,f:()=>s});const h=o(),p=a(),f=l(),g=c(),_=d(),v=u();Object.freeze(Object.defineProperty({__proto__:null,ONES:p,UNIT_W:v,UNIT_X:f,UNIT_Y:g,UNIT_Z:_,ZEROS:h,clone:i,create:r,createView:function(e,t){return new Float32Array(e,t,4)},fromValues:s,ones:a,unitW:u,unitX:l,unitY:c,unitZ:d,zeros:o},Symbol.toStringTag,{value:"Module"}))},97942:(e,t,n)=>{function r(e){let t,n,r=[],i=!1;return function(){for(var s=arguments.length,o=new Array(s),a=0;a<s;a++)o[a]=arguments[a];return i&&t===this&&function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}(o,r)||(n=e.apply(this,o),t=this,r=o,i=!0),n}}n.d(t,{H:()=>r})},87072:(e,t,n)=>{function r(e){var t;const n=e.layer;return"floorInfo"in n&&null!==(t=n.floorInfo)&&void 0!==t&&t.floorField&&"floors"in e.view?s(e.view.floors,n.floorInfo.floorField):null}function i(e,t){var n;return"floorInfo"in t&&null!==(n=t.floorInfo)&&void 0!==n&&n.floorField?s(e,t.floorInfo.floorField):null}function s(e,t){if(null===e||void 0===e||!e.length)return null;const n=e.filter((e=>""!==e)).map((e=>"'".concat(e,"'")));return n.push("''"),"".concat(t," IN (").concat(n.join(","),") OR ").concat(t," IS NULL")}n.d(t,{c:()=>r,f:()=>i})},62815:(e,t,n)=>{n.d(t,{_:()=>ne});var r=n(51995),i=n(86950),s=(n(93169),n(42537)),o=n(11186),a=n(71353),l=n(5986),c=n(74509),d=n(90045),u=n(151),h=n(70444),p=n(95773),f=n(85981),g=n(40885),_=n(19182),v=n(62389),y=n(19265),m=n(70619),w=n(56529),S=n(39077),E=n(4760),b=n(58901);class x extends _.i{constructor(e){super(e),this._ray=(0,g.Ue)(),this._isWorldDown=!1,this._start=(0,a.c)(),this._end=(0,a.f)(1,0,0),this._width=1,this._color=(0,u.f)(1,0,1,1),this._polygonOffset=!1,this._writeDepthEnabled=!0,this._innerWidth=0,this._innerColor=(0,u.f)(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._stipplePreferContinuous=!0,this._falloff=0,this._extensionType=D.LINE,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=w.yD.OccludeAndTransparent,this._fadedExtensions=A,this._laserline=new v.W({view:this.view,isDecoration:e.isDecoration}),this.applyProperties(e)}destroy(){this._laserline.destroy(),super.destroy()}createObject3DResourceFactory(e){return{view:e,createResources:e=>this._createObject3DResources(e),destroyResources:e=>this._destroyExternalResources(e),recreateGeometry:(e,t)=>this._recreateObject3DGeometry(e,t),cameraChanged:()=>this._updateGeometry()}}createDrapedResourceFactory(e){return{view:e,createResources:()=>this._createDrapedResources(),destroyResources:e=>this._destroyExternalResources(e),recreateGeometry:e=>this._recreateDrapedGeometry(e)}}updateVisibility(e){super.updateVisibility(e),this._laserline.visible=e}onAttachedChange(){this._laserline.attached=this._laserlineAttached}setStartEndFromWorldDownAtLocation(e){this._isWorldDown=!0,(0,o.c)(this._start,e),this.view.renderCoordsHelper.worldUpAtPosition(e,this._end),(0,o.f)(this._end,e,this._end),(0,g.zk)(this._start,this._end,this._ray),this._updateGeometry()}get start(){return this._start}set start(e){this._isWorldDown=!1,(0,o.h)(this._start,e)||((0,o.c)(this._start,e),(0,g.zk)(this._start,this._end,this._ray),this._updateGeometry())}get end(){return this._end}set end(e){this._isWorldDown=!1,(0,o.h)(this._end,e)||((0,o.c)(this._end,e),(0,g.zk)(this._start,this._end,this._ray),this._updateGeometry())}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get color(){return this._color}set color(e){(0,d.h)(e,this._color)||((0,d.c)(this._color,e),this._updateMaterial())}get polygonOffset(){return this._polygonOffset}set polygonOffset(e){e!==this._polygonOffset&&(this._polygonOffset=e,this._updateMaterial())}get writeDepthEnabled(){return this._writeDepthEnabled}set writeDepthEnabled(e){this._writeDepthEnabled!==e&&(this._writeDepthEnabled=e,this._updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(e){e!==this._innerWidth&&(this._innerWidth=e,this._updateMaterial())}get innerColor(){return this._innerColor}set innerColor(e){(0,d.h)(e,this._innerColor)||((0,d.c)(this._innerColor,e),this._updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(e){const t=null!=e!=(null!=this._stipplePattern);this._stipplePattern=e,t?this.recreate():this._updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(e){null!=e&&null!=this._stippleOffColor&&(0,d.h)(e,this._stippleOffColor)||(this._stippleOffColor=null!=e?(0,u.c)(e):null,this._updateMaterial())}get stipplePreferContinuous(){return this._stipplePreferContinuous}set stipplePreferContinuous(e){e!==this._stipplePreferContinuous&&(this._stipplePreferContinuous=e,this._updateMaterial())}get falloff(){return this._falloff}set falloff(e){e!==this._falloff&&(this._falloff=e,this._updateMaterial())}get extensionType(){return this._extensionType}set extensionType(e){e!==this._extensionType&&(this._extensionType=e,this.recreateGeometry())}get _laserlineAttached(){return this._laserlineEnabled&&null!=this._laserlineStyle&&this.attached&&!this.isDraped}get laserlineStyle(){return this._laserlineStyle}set laserlineStyle(e){this._laserlineStyle=e,this._laserline.attached=this._laserlineAttached,null!=e&&(this._laserline.style=e)}get laserlineEnabled(){return this._laserlineEnabled}set laserlineEnabled(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,this._laserline.attached=this._laserlineAttached)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}get _normalizedRenderOccluded(){return this.isDraped&&this._renderOccluded===w.yD.OccludeAndTransparentStencil?w.yD.OccludeAndTransparent:this._renderOccluded}get fadedExtensions(){return this._fadedExtensions}set fadedExtensions(e){this._fadedExtensions=null!==e&&void 0!==e?e:A,this.recreateGeometry()}_updateMaterial(){var e,t;const{materialParameters:n}=this;null!==(e=this.object3dResources.resources)&&void 0!==e&&e.material.setParameters(n),null===(t=this.drapedResources.resources)||void 0===t||t.material.setParameters(n)}get materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:this._stipplePreferContinuous,innerWidth:this._innerWidth,innerColor:this._innerColor,falloff:this._falloff,hasPolygonOffset:this._polygonOffset,renderOccluded:this._normalizedRenderOccluded,isDecoration:this.isDecoration,writeDepth:this._writeDepthEnabled}}_createObject3DResources(e){const t=new b.U(this.materialParameters),n=new Array;return this._createObject3DGeometry(t,e,n),{material:t,geometries:n,forEach:e=>{e(t),n.forEach(e)}}}_destroyExternalResources(e){e.geometries=[]}_recreateObject3DGeometry(e,t){e.geometries.length=0,this._createObject3DGeometry(e.material,t,e.geometries)}_createObject3DGeometry(e,t,n){const r=this._createGeometry(e);n.push(r),t.addGeometry(r),this._updateVerticesObject3D(t)}_createDrapedResources(){const e=new b.U(this.materialParameters);return{material:e,geometries:[this._createDrapedGeometry(e)]}}_recreateDrapedGeometry(e){e.geometries=[this._createDrapedGeometry(e.material)]}_createDrapedGeometry(e){const t=this._createGeometry(e);return this._updateVerticesDraped(t),new S.z(t)}_createGeometry(e){const t=this.extensionType===D.FADED,n=t?[(0,a.c)(),(0,a.c)(),(0,a.c)(),(0,a.c)()]:[(0,a.c)(),(0,a.c)()];return(0,m.rh)(e,n,null,t?[1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,0]:null)}_updateGeometry(){if(this.isDraped)this.drapedResources.recreateGeometry();else{const e=this.object3dResources.object;e&&this._updateVerticesObject3D(e)}}_updateVerticesObject3D(e){const t=this._lineSegment;this._updateVertexAttributesObject3D(e,t),this._laserline.intersectsLine=t}_updateVerticesDraped(e){this._updateVertexAttributesDraped(e,this._lineSegment)}get _lineSegment(){return this._extensionType===D.FADED?this._updateLineSegmentFinite(T):this._updateLineSegmentInfinite(this._extensionType,T)}_updateLineSegmentFinite(e){return(0,f.zk)(this._start,this._end,e)}_updateLineSegmentInfinite(e,t){const n=this.view.state.camera;switch((0,h.iL)(this._ray,P),e){case D.LINE:P.c0=-Number.MAX_VALUE;break;case D.RAY:case D.GROUND_RAY:{var r;const e=this._ray.origin,t=null!==(r=this.view.elevationProvider.getElevation(e[0],e[1],e[2],this.view.renderCoordsHelper.spatialReference,"ground"))&&void 0!==r?r:0,n=this.view.renderCoordsHelper.getAltitude(e);this._isWorldDown&&n<t&&(0,o.E)(P.ray.direction,P.ray.direction),this._extensionType===D.GROUND_RAY&&null!=t&&(P.c1=Math.abs(n-t));break}}if(!(0,p.zq)(n.frustum,P))return this._updateLineSegmentFinite(t);const i=(0,h.Ws)(P,R),s=(0,h.S$)(P,C);return(0,f.zk)(i,s,t)}_updateVertexAttributesObject3D(e,t){var n;const r=null===(n=e.geometries[0].getMutableAttribute(E.T.POSITION))||void 0===n?void 0:n.data;if(!r)return;let i=0;for(const s of this._lineVertices(t))r[i++]=s[0],r[i++]=s[1],r[i++]=s[2];e.geometryVertexAttributeUpdated(e.geometries[0],E.T.POSITION)}_updateVertexAttributesDraped(e,t){var n;const r=null===(n=e.getMutableAttribute(E.T.POSITION))||void 0===n?void 0:n.data;if(!r)return;let i=0;for(const s of this._lineVertices(t))r[i++]=s[0],r[i++]=s[1],r[i++]=y.gi;e.invalidateBoundingInfo()}*_lineVertices(e){this.extensionType===D.FADED?(yield(0,f.KU)(e,-this.fadedExtensions.start,R),yield(0,f.KU)(e,0,R),yield(0,f.KU)(e,1,R),yield(0,f.KU)(e,1+this.fadedExtensions.end,R)):(yield(0,f.KU)(e,0,R),yield(0,f.KU)(e,1,R))}}const P=(0,h.Ue)(),R=(0,a.c)(),C=(0,a.c)(),T=(0,f.Ue)();var D,O;(O=D||(D={}))[O.LINE=0]="LINE",O[O.RAY=1]="RAY",O[O.GROUND_RAY=2]="GROUND_RAY",O[O.FADED=3]="FADED";const L=1/3,A={start:L,end:L};var j=n(94172),F=n(17842),G=n(88396),I=n(6394),M=n(55946);class N extends _.i{constructor(e){super(e),this._location=(0,a.c)(),this._direction=(0,a.f)(1,0,0),this._width=1,this._offset=1,this._length=18,this._color=(0,u.f)(1,0,1,1),this._renderOccluded=w.yD.OccludeAndTransparent,this.applyProperties(e)}createObject3DResourceFactory(e){return{view:e,createResources:e=>this._createObject3DResources(e),destroyResources:e=>this._destroyObject3DResources(e),recreateGeometry:(e,t)=>this._recreateObject3DGeometry(e,t),cameraChanged:()=>this._updateGeometry()}}createDrapedResourceFactory(e){return{view:e,createResources:()=>this._createDrapedResources(),destroyResources:e=>this._destroyDrapedResources(e),recreateGeometry:e=>this._recreateDrapedGeometry(e)}}get location(){return this._location}set location(e){(0,o.h)(this._location,e)||((0,o.c)(this._location,e),this._updateGeometry())}get direction(){return this._direction}set direction(e){(0,o.h)(this._direction,e)||((0,o.c)(this._direction,e),this._updateGeometry())}setDirectionFromPoints(e,t){(0,o.n)(this._direction,(0,o.f)(this._direction,t,e)),this._updateGeometry()}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get offset(){return this._offset}set offset(e){e!==this._offset&&(this._offset=e,this._updateGeometry())}get length(){return this._length}set length(e){e!==this._length&&(this._length=e,this._updateGeometry())}get color(){return this._color}set color(e){(0,d.h)(e,this._color)||((0,d.c)(this._color,e),this._updateMaterial())}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}_createObject3DResources(e){const t=new b.U(this.materialParameters),n=new Array;return this._createObject3DGeometry(t,e,n),{material:t,geometries:n,forEach:e=>{e(t),n.forEach(e)}}}_destroyObject3DResources(e){e.geometries.length=0}_recreateObject3DGeometry(e,t){e.geometries.length=0,this._createObject3DGeometry(e.material,t,e.geometries)}_createObject3DGeometry(e,t,n){const[r,i]=this._createGeometries(e);t.addGeometry(r),t.addGeometry(i),n.push(r),n.push(i),this._updateVerticesObject3D(t)}_createDrapedResources(){const e=new b.U(this.materialParameters),t=(0,j.YP)((()=>this.view.state.contentPixelRatio),(()=>{this.drapedResources.recreateGeometry()}));return{material:e,geometries:this._createDrapedGeometry(e),pixelRatioHandle:t}}_destroyDrapedResources(e){e.pixelRatioHandle.remove(),e.geometries=[]}_recreateDrapedGeometry(e){e.geometries=this._createDrapedGeometry(e.material)}_createDrapedGeometry(e){const t=this._createGeometries(e);return this._updateVerticesDraped(t),t.map((e=>new S.z(e)))}_createGeometries(e){return[(0,m.rh)(e,[(0,a.c)(),(0,a.c)()]),(0,m.rh)(e,[(0,a.c)(),(0,a.c)()])]}_updateMaterial(){var e,t;const{materialParameters:n}=this;null!==(e=this.object3dResources.resources)&&void 0!==e&&e.material.setParameters(n),null===(t=this.drapedResources.resources)||void 0===t||t.material.setParameters(n)}get materialParameters(){return{width:this._width,color:this._color,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}_updateGeometry(){if(this.isDraped)this.drapedResources.recreateGeometry();else{const e=this.object3dResources.object;e&&this._updateVerticesObject3D(e)}}_updateVerticesObject3D(e){const t=this.view.state.camera;t.projectToScreen(this.location,H),(0,o.g)(V,this.location,this.direction),t.projectToScreen(V,U),(0,G.e)(U,(0,G.c)(U,U,H)),this._updateVertexAttributesObject3D(t,e,0,H,U,1),this._updateVertexAttributesObject3D(t,e,1,H,U,-1)}_updateVertexAttributesObject3D(e,t,n,r,i,s){var o;const a=t.geometries[n],l=null===(o=a.getMutableAttribute(E.T.POSITION))||void 0===o?void 0:o.data;if(!l)return;const{start:c,end:d}=this._computeStartEnd(i,r,s,this.offset,this.width,this.length);e.unprojectFromScreen((0,F.c$)(c),V),l[0]=V[0],l[1]=V[1],l[2]=V[2],e.unprojectFromScreen((0,F.c$)(d),V),l[3]=V[0],l[4]=V[1],l[5]=V[2],t.geometryVertexAttributeUpdated(a,E.T.POSITION)}_updateVerticesDraped(e){const{view:{basemapTerrain:{overlayManager:t},state:{contentPixelRatio:n}}}=this,{location:r,width:i,length:s,offset:o}=this,a=Z;a.spatialReference=t.renderer.spatialReference,a.x=r[0],a.y=r[1];const l=this.view.overlayPixelSizeInMapUnits(a)*n,c=i*l,d=s*l,u=o*l;this._updateVertexAttributesDraped(e[0],c,d,u,-1),this._updateVertexAttributesDraped(e[1],c,d,u,1)}_updateVertexAttributesDraped(e,t,n,r,i){var s;const o=null===(s=e.getMutableAttribute(E.T.POSITION))||void 0===s?void 0:s.data;if(!o)return;const{location:a,direction:l}=this,{start:c,end:d}=this._computeStartEnd(l,a,i,r,t,n);o[0]=c[0],o[1]=c[1],o[2]=y.gi,o[3]=d[0],o[4]=d[1],o[5]=y.gi,e.invalidateBoundingInfo()}_computeStartEnd(e,t,n,r,i,s){const o=(0,G.a)(z,(0,G.s)(z,e[1]*n,e[0]*-n),r+i/2),a=(0,G.i)(k,(0,G.i)(k,(0,G.i)(k,t,(0,G.a)(k,e,s/2)),o),o);return{start:a,end:(0,G.i)(q,a,(0,G.a)(q,e,-s))}}}const V=(0,a.c)(),z=(0,I.a)(),k=(0,I.a)(),q=(0,I.a)(),H=(0,F.s1)(),U=(0,F.s1)(),Z=(0,M.T)(0,0,void 0,null);var W=n(66730),Y=n(98917),B=n(26279),J=n(38054),X=n(76014),K=n(80371),$=n(64674),Q=n(38561),ee=n(53397),te=n(11208);class ne extends Q.a{sortUniqueHints(e){return e.sort(((e,t)=>(t instanceof ee.w?t.length:0)-(e instanceof ee.w?e.length:0)))}visualizeIntersectionPoint(e,t){const{spatialReference:n,view:r}=t,i=re(t);return(0,s.ed)(new W.L({view:r,primitive:"circle",geometry:(0,J.Ju)(e.intersectionPoint,n),elevationInfo:e.isDraped?c.tR:c.jG,size:20,outlineSize:2,color:i.intersectionPointColor,outlineColor:i.intersectionPointOutlineColor,pixelSnappingEnabled:!1,isDecoration:!0,attached:!0}))}visualizePoint(e,t){const{view:n,spatialReference:r}=t,i=re(t),o=ie(e.point,e.domain,t);return(0,s.ed)(new W.L({view:n,primitive:"circle",geometry:(0,J.Ju)(o,r),elevationInfo:se(e,t),size:20,outlineSize:2,color:i.pointColor,outlineColor:i.pointOutlineColor,pixelSnappingEnabled:!1,isDecoration:!0,attached:!0}))}visualizeLine(e,t){const{view:n,spatialReference:r}=t,i=re(t),o=ie(e.lineStart,e.domain,t),a=ie(e.lineEnd,e.domain,t);return(0,s.ed)(this._createLineSegmentHint(e.type,o,a,r,se(e,t),n,i,e.isDraped,e.fadeLeft,e.fadeRight))}visualizeParallelSign(e,t){const{view:n,spatialReference:r}=t,i=re(t),{isDraped:a}=e,l=se(e,t),c=ie(e.lineStart,e.domain,t),d=ie(e.lineEnd,e.domain,t),u=ae(c,r,l,n,a),h=ae(d,r,l,n,a),p=(0,o.p)(h,u,h,.5),f=new N({view:n,attached:!1,offset:X.c.parallelLineHintOffset,length:X.c.parallelLineHintLength,width:X.c.parallelLineHintWidth,color:i.parallelSignColor,location:p,renderOccluded:a?w.yD.OccludeAndTransparent:w.yD.Opaque,isDraped:a,renderGroup:B.eZ.SnappingHint,isDecoration:!0});return f.setDirectionFromPoints(u,p),f.attached=!0,(0,s.ed)(f)}visualizeRightAngleQuad(e,t){const{view:n,spatialReference:r}=t,i=re(t),o=se(e,t),{isDraped:a}=e,l=ie(e.previousVertex,e.domain,t),c=ie(e.centerVertex,e.domain,t),d=ie(e.nextVertex,e.domain,t),u=ae(l,r,o,n,a),h=ae(c,r,o,n,a),p=ae(d,r,o,n,a);return(0,s.ed)(new Y.R({view:n,attached:!0,color:a?i.rightAngleColorDraped:i.rightAngleColor,renderOccluded:a?w.yD.OccludeAndTransparent:w.yD.Transparent,outlineRenderOccluded:a?w.yD.OccludeAndTransparent:w.yD.Opaque,outlineColor:i.rightAngleOutlineColor,outlineSize:X.c.rightAngleHintOutlineSize,size:X.c.rightAngleHintSize,isDraped:a,geometry:{previous:u,center:h,next:p},renderGroup:B.eZ.SnappingHint,isDecoration:!0}))}_createLineSegmentHint(e,t,n,r,i,s,o){let a=arguments.length>7&&void 0!==arguments[7]&&arguments[7],l=!(arguments.length>8&&void 0!==arguments[8])||arguments[8],c=!(arguments.length>9&&void 0!==arguments[9])||arguments[9];const d=ae(t,r,i,s,a),u=ae(n,r,i,s,a),h=new x({view:s,extensionType:D.FADED,start:d,end:u,isDraped:a,color:o.lineColor,renderOccluded:a?w.yD.OccludeAndTransparent:w.yD.Opaque,renderGroup:B.eZ.SnappingHint,isDecoration:!0});switch(e){case $.ze.TARGET:h.width=X.c.lineHintWidthTarget,h.fadedExtensions={start:0,end:X.c.lineHintFadedExtensions};break;case $.ze.REFERENCE_EXTENSION:h.width=X.c.lineHintWidthReference,h.fadedExtensions={start:0,end:0};break;case $.ze.REFERENCE:h.width=X.c.lineHintWidthReference,h.fadedExtensions={start:l?X.c.lineHintFadedExtensions:0,end:c?X.c.lineHintFadedExtensions:0}}return h.attached=!0,h}}function re(e){const{effectiveTheme:t}=e.view,n=r.Z.toUnitRGBA(t.accentColor),s=[0,0,0,0];return{intersectionPointColor:s,intersectionPointOutlineColor:n,pointColor:s,pointOutlineColor:n,lineColor:n,lineOutlineColor:void 0,parallelSignColor:n,rightAngleColor:n,rightAngleColorDraped:r.Z.toUnitRGBA((0,i.G)(t.accentColor,.5)),rightAngleOutlineColor:n}}function ie(e,t,n){const r=oe(t,n);return null==r?e:(0,J.Ue)(e[0],e[1],r)}function se(e,t){return null!=oe(e.domain,t)?t.selfSnappingZ.elevationInfo:e.isDraped?c.tR:c.jG}function oe(e,t){let{selfSnappingZ:n}=t;return e===K.B.SELF&&null!=n?n.value:null}function ae(e,t,n,r,i){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:(0,a.c)();if(i){const n=r.basemapTerrain.overlayManager.renderer.spatialReference;(0,l.S)(e,t,s,n)}else(0,te.RS)(e,t,n,r,s);return s}},51328:(e,t,n)=>{n.d(t,{J4:()=>_,_N:()=>f,cx:()=>r,gv:()=>v});var r,i,s=n(17842),o=(n(11186),n(71353)),a=(n(79803),n(55652)),l=n(40885),c=(n(40927),n(51378)),d=(n(74509),n(81703)),u=n(88153),h=n(54463),p=n(76783);n(5693);function f(e,t){return g(e,(()=>t))}function g(e,t){const n=(0,o.c)(),r=(0,o.c)();let i=!1;return o=>{const l=t(o);if("start"===o.action){const t=(0,s.md)(o.screenStart,(0,s.c$)(c.qW.get())),r=(0,d.u4)(e.state.camera,t,y);null!=r&&(i=(0,a.BR)(l,r,n))}if(!i)return null;const u=(0,s.md)(o.screenEnd,(0,s.c$)(c.qW.get())),h=(0,d.u4)(e.state.camera,u,y);return null==h?null:(0,a.BR)(l,h,r)?{...o,renderStart:n,renderEnd:r,plane:l,ray:h}:null}}function _(e){let t=null;return n=>{switch(n.action){case"start":t=e.disableDisplay();break;case"end":case"cancel":null!=t&&(t.remove(),t=null)}return n}}function v(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=(0,u.Z8)(e.state.viewingMode);n.options.selectionMode=!0,n.options.store=h.eC.MIN,n.options.hud=!1;const i=(0,s.s1)(),a={requiresGroundFeedback:!0,enableDraped:!0,exclude:new Set},l=(0,o.c)(),c=null!==t&&void 0!==t?t:e.spatialReference,d=t=>{e.map.ground&&e.map.ground.opacity<1?a.exclude.add(p.xX):a.exclude.delete(p.xX),e.sceneIntersectionHelper.intersectIntersectorScreen((0,s.md)(t,i),n,a);const o=n.results.min;let d;if(o.getIntersectionPoint(l))d=o.intersector===h.q7.TERRAIN?r.GROUND:r.OTHER;else{if(!n.results.ground.getIntersectionPoint(l))return null;d=r.GROUND}return{location:e.renderCoordsHelper.fromRenderCoords(l,c),surfaceType:d}};let f;return e=>{if("start"===e.action){const t=d(e.screenStart);f=null!=t?t.location:null}if(null==f)return null;const t=d(e.screenEnd);return null!=(null===t||void 0===t?void 0:t.location)?{...e,mapStart:f,mapEnd:t.location,surfaceType:t.surfaceType}:null}}(i=r||(r={}))[i.GROUND=0]="GROUND",i[i.OTHER=1]="OTHER";(0,o.c)(),(0,o.c)();const y=(0,l.Ue)()},44179:(e,t,n)=>{n.d(t,{Hk:()=>g,M8:()=>G,aU:()=>A,jg:()=>j,kt:()=>w,ku:()=>v});var r=n(63780),i=n(88396),s=n(6394),o=n(11186),a=n(71353),l=n(55652),c=n(40885),d=n(23470),u=n(38054),h=n(55793),p=n(94163);class f{intersect(e){return I(this,e)}closestPoints(e){return[this.closestTo(e)]}}class g extends f{constructor(e){super(),this.point=e}equals(e){return this===e||J(e)&&(0,o.h)(this.point,e.point)}closestTo(){return(0,u.d9)(this.point)}}class _ extends f{constructor(e,t,n){super(),this.start=e,this.end=t,this.lineLike={start:e,end:t,type:n}}equals(e){return this===e||X(e)&&this.lineLike.type===e.lineLike.type&&(0,o.h)(this.start,e.start)&&(0,o.h)(this.end,e.end)}closestTo(e){const t=(0,h.ZE)(e,this.lineLike);return(0,u.uo)(t)}}class v extends _{constructor(e,t){super(e,t,p.SP.LINE)}}class y extends _{constructor(e,t){super(e,t,p.SP.RAY)}}class m extends f{constructor(e){super(),this.constraints=e}equals(e){return this===e||B(e)&&(0,r.fS)(this.constraints,e.constraints,((e,t)=>e.equals(t)))}closestTo(e){let t,n=1/0;for(const r of this.constraints){const i=r.closestTo(e),s=(0,o.a)(e,i);s<n&&(n=s,t=i)}return t?(0,u.d9)(t):e}closestPoints(e){return this.constraints.flatMap((t=>t===this?[]:t.closestPoints(e)))}}class w extends f{constructor(e,t){super(),this.center=e,this.radius=t}equals(e){return this===e||Q(e)&&this.center[0]===e.center[0]&&this.center[1]===e.center[1]&&this.radius===e.radius}closestTo(e){const t=(0,h.sc)(e,this.center,this.radius);return(0,u.uo)(t)}}class S extends f{constructor(e,t){super(),this.center=e,this.radius=t}equals(e){return this===e||ee(e)&&(0,o.h)(this.center,e.center)&&this.radius===e.radius}closestTo(e){const t=(0,h.sc)(e,this.center,this.radius);return t[2]=this.center[2],(0,u.uo)(t)}asCircle(){return new E((0,u.d9)(this.center),this.radius,(0,u.al)(0,0,1))}}class E extends f{constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0;super(),this.center=e,this.radius=t,this.normal=n,this.slicePlane=r}equals(e){return this===e||te(e)&&(0,o.h)(this.center,e.center)&&(0,o.h)(this.normal,e.normal)&&this.radius===e.radius}closestTo(e){const{center:t,radius:n}=this;(0,l.nF)(this.getPlane(x),e,b);const r=(0,o.u)(b,b,t),i=(0,o.m)(r);if((0,h.hA)(i,0))return(0,u.d9)(e);const s=n/Math.sqrt(i),c=(0,o.q)((0,a.c)(),t,r,s),{slicePlane:d}=this;if(d&&!(0,h.zf)(d,c)){var p;const t=N(d,this);return null!==(p=null===t||void 0===t?void 0:t.closestTo(e))&&void 0!==p?p:(0,u.d9)(e)}return(0,u.uo)(c)}getPlane(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,l.Ue)();return(0,l.Yq)(this.center,this.normal,e)}}const b=(0,a.c)(),x=(0,l.Ue)();class P extends f{constructor(e){super(),this.z=e}equals(e){return this===e||K(e)&&this.z===e.z}closestTo(e){return(0,u.uo)((0,a.f)(e[0],e[1],this.z))}getPlane(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,l.Ue)();return(0,o.s)(R,0,0,this.z),(0,l.Yq)(R,a.d,e)}}const R=(0,a.c)();class C extends f{constructor(e,t,n){super(),this.start=e,this.end=t,this.planeLike={start:e,end:t,type:n}}equals(e){return this===e||$(e)&&this.planeLike.type===e.planeLike.type&&(0,o.h)(this.start,e.start)&&(0,o.h)(this.end,e.end)}closestTo(e){return(0,u.uo)((0,h.z9)(e,this.planeLike))}closestEndTo(e){const{start:t,end:n}=this;return Math.sign((0,i.g)((0,i.c)(T,n,t),(0,i.c)(D,e,t)))>0?n:t}getPlane(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,l.Ue)();const t=(0,o.c)(O,this.end);return t[2]+=1,(0,l.zk)(this.start,this.end,t,e)}getSlicePlane(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,l.Ue)();const{start:t,end:n,type:r}=this.planeLike;if(r===h.Jk.PLANE)return;const i=(0,o.s)(O,t[0],t[1],0),s=(0,o.s)(L,n[0],n[1],0),a=(0,o.f)(L,s,i);return(0,l.Yq)(i,a,e),e}}const T=(0,s.a)(),D=(0,s.a)(),O=(0,a.c)(),L=(0,a.c)();class A extends C{constructor(e,t){super(e,t,h.Jk.HALF_PLANE)}}class j extends C{constructor(e,t){super(e,t,h.Jk.PLANE)}}class F extends f{constructor(e,t){super(),this.sphere=(0,d.k)(e,t)}equals(e){return this===e||ne(e)&&(0,d.l)(this.sphere,e.sphere)}closestTo(e){const t=(0,d.p)(this.sphere,e,(0,a.c)());return(0,u.uo)(t)}get center(){return this.sphere}get radius(){return this.sphere[3]}}class G extends f{constructor(e,t,n){super(),this.start=e,this.end=t,this.getZ=n,this.planeLike={start:e,end:t,type:h.Jk.PLANE}}equals(e){return this===e||re(e)&&(0,o.h)(this.start,e.start)&&(0,o.h)(this.end,e.end)&&this.getZ===e.getZ}closestTo(e){return function(e,t){var n;const r=(0,h.z9)(t,e.planeLike);return r[2]=null!==(n=e.getZ(r[0],r[1]))&&void 0!==n?n:ie,(0,u.uo)(r)}(this,e)}addIfOnTheGround(e,t){for(const r of t){var n;const t=null!==(n=this.getZ(r[0],r[1]))&&void 0!==n?n:0;(0,h.hA)(r[2],t)&&(r[2]=t,e.push(r))}}}function I(e,t){if(B(e)){const n=[];for(const r of e.constraints){const e=r.intersect(t);e&&n.push(e)}return Y(n)}if(B(t))return I(t,e);if(re(e))return H(e,t);if(re(t))return H(t,e);if(J(e)){const{point:n}=e,r=t.closestTo(n);return(0,o.G)(r,n)?e:void 0}if(X(e)){if(J(t))return I(t,e);if(X(t))return Z((0,h.Au)(e.lineLike,t.lineLike));if(K(t))return M(e,t);if($(t))return Z((0,h.fK)(t.planeLike,e.lineLike));if(Q(t))return Z((0,h.CJ)(e.lineLike,t.center,t.radius));if(te(t))return Z((0,h.UG)(e.lineLike,t));if(ee(t))return function(e,t){let{lineLike:n}=e,{center:r,radius:i}=t;const s=r[2];return Z((0,h.CJ)(n,r,i).filter((e=>(0,h.hA)(e[2],s))))}(e,t);if(ne(t))return function(e,t){let{lineLike:n}=e,{sphere:r}=t;return Z((0,d.m)(r,n.start,n.end))}(e,t)}else if(K(e)){if(J(t)||X(t))return I(t,e);if(K(t))return function(e,t){return(0,h.hA)(e.z,t.z)?e:void 0}(e,t);if($(t))return function(e,t){let{z:n}=e,{planeLike:r}=t;const[i,s]=r.start,[o,a]=r.end,l=(0,u.al)(i,s,n),c=(0,u.al)(o,a,n);return r.type===h.Jk.PLANE?new v(l,c):new y(l,c)}(e,t);if(Q(t))return function(e,t){const[n,r]=t.center;return new S((0,u.al)(n,r,e.z),t.radius)}(e,t);if(te(t))return V(e,t);if(ee(t))return function(e,t){return(0,h.hA)(t.center[2],e.z)?t:void 0}(e,t);if(ne(t))return function(e,t){let{center:n,radius:r}=t;const i=Math.abs(n[2]-e.z);if(i>r&&!(0,h.hA)(i,r))return;const s=(0,u.al)(n[0],n[1],e.z),o=Math.sqrt(r**2-i**2);return(0,h.hA)(o,0)?void 0:new S(s,o)}(e,t)}else if($(e)){if(J(t)||X(t)||K(t))return I(t,e);if($(t))return U((0,h.Nn)(e.planeLike,t.planeLike));if(Q(t))return U((0,h.SD)(e.planeLike,t.center,t.radius));if(te(t))return k(e,t);if(ee(t))return z(e,t);if(ne(t))return q(e,t)}else if(Q(e)){if(J(t)||X(t)||K(t)||$(t))return I(t,e);if(Q(t))return U((0,h.Yf)(e.center,e.radius,t.center,t.radius));if(te(t))return;if(ee(t))return function(e,t){const n=(0,i.k)(e.center,t.center);return(0,h.hA)(n,0)&&(0,h.hA)(e.radius,t.radius)?t:W((0,h.Yf)(e.center,e.radius,t.center,t.radius),t.center[2])}(e,t);if(ne(t))return}else if(te(e)){if(J(t)||X(t)||K(t)||$(t)||Q(t))return I(t,e);if(te(t))return;if(ee(t))return void t.asCircle();if(ne(t))return}else if(ee(e)){if(J(t)||X(t)||K(t)||$(t)||Q(t)||te(t))return I(t,e);if(ee(t))return function(e,t){if(!(0,h.$7)(e.center,t.center))return;const n=(0,i.k)(e.center,t.center);return(0,h.hA)(n,0)&&(0,h.hA)(e.radius,t.radius)?e:W((0,h.Yf)(e.center,e.radius,t.center,t.radius),e.center[2])}(t,e);if(ne(t))return}else if(ne(e)){if(J(t)||X(t)||K(t)||$(t)||Q(t)||ee(t))return I(t,e);if(ne(t))return}}const M=(()=>{const e=(0,l.Ue)();return(t,n)=>{const{start:r,end:i}=t;if((0,h.$7)(r,i)&&(0,h.hA)(r[2],n.z))return t;const s=(0,a.c)();return(0,l.fn)(n.getPlane(e),r,i,s)?new g((0,u.uo)(s)):void 0}})();const N=(()=>{const e=(0,c.Ue)(),t=(0,l.Ue)(),n={start:(0,a.c)(),end:(0,a.c)(),type:p.SP.LINE};return(r,i,s)=>{const{normal:c,center:d,radius:p}=i,f=(0,o.j)(c,(0,l.mJ)(r)),_=(0,h.hA)((0,l.TE)(r,d),0);if((0,h.hA)(f,1))return _?i:void 0;if(i.getPlane(t),_&&(0,h.hA)(f,0)&&(0,l.cp)(r)&&(0,l.cp)(t)){if((0,h.hA)(p,0))return!s||(0,h.zf)(s,d)?new g((0,u.d9)(d)):void 0;const e=(0,a.g)(d);e[2]+=p;const t=(0,a.g)(d);t[2]-=p;const n=[];return s&&!(0,h.zf)(s,e)||n.push(e),s&&!(0,h.zf)(s,t)||n.push(t),Z(n)}if(!(0,l.wm)(r,t,e))return;(0,o.c)(n.start,e.origin),(0,o.g)(n.end,e.origin,e.direction);const v=(0,h.UG)(n,i);return Z(s?(0,h.rq)(s,v):v)}})();const V=(()=>{const e=(0,l.Ue)();return(t,n)=>N(t.getPlane(e),n)})();const z=(()=>{const e=(0,l.Ue)();return(t,n)=>{let{center:r,radius:i}=n;const s=(0,h.SD)(t.planeLike,r,i),o=r[2];t.getSlicePlane(e);const a=[];for(const[l,c]of s){const t=[l,c,o];(0,h.zf)(e,t)&&a.push(t)}return Z(a)}})(),k=(()=>{const e=(0,l.Ue)(),t=(0,l.Ue)();return(n,r)=>N(n.getPlane(e),r,n.getSlicePlane(t))})(),q=(()=>{const e=(0,l.Ue)();return(t,n)=>{let{center:r,radius:i}=n;const s=t.getPlane(e),c=(0,l.jH)(s,r),d=Math.abs(c);if(d>i&&!(0,h.hA)(d,i))return;const p=(0,a.g)((0,l.mJ)(s)),f=(0,o.q)((0,a.c)(),r,p,c),_=Math.sqrt(i**2-c**2);return(0,h.hA)(_,0)?new g((0,u.uo)((0,l.nF)(s,r,(0,a.c)()))):new E((0,u.uo)(f),_,p,t.getSlicePlane())}})();function H(e,t){const{planeLike:n,getZ:r}=e,i=[];if(J(t))e.addIfOnTheGround(i,(0,h.hm)(n,t.point));else if(X(t))e.addIfOnTheGround(i,(0,h.fK)(n,t.lineLike));else if(Q(t))for(const[o,l]of(0,h.SD)(n,t.center,t.radius)){const e=r(o,l);null!=e&&i.push((0,a.f)(o,l,e))}else if($(t)||re(t))for(const[o,l]of(0,h.Nn)(n,t.planeLike)){var s;const e=null!==(s=r(o,l))&&void 0!==s?s:ie;i.push((0,a.f)(o,l,e))}return Z(i)}function U(e){return Y(e.map((e=>{let[t,n]=e;const r=(0,u.al)(t,n,0),i=(0,u.al)(t,n,1);return new v(r,i)})))}function Z(e){return Y(e.map((e=>e?new g((0,u.uo)(e)):void 0)))}function W(e,t){return Z(e.map((e=>{let[n,r]=e;return[n,r,t]})))}function Y(e){var t;if(0!==e.length)return 1===e.length?null!==(t=e[0])&&void 0!==t?t:void 0:new m(e.filter(r.pC))}function B(e){return e instanceof m}function J(e){return e instanceof g}function X(e){return e instanceof _}function K(e){return e instanceof P}function $(e){return e instanceof C}function Q(e){return e instanceof w}function ee(e){return e instanceof S}function te(e){return e instanceof E}function ne(e){return e instanceof F}function re(e){return e instanceof G}const ie=0},92839:(e,t,n)=>{n.d(t,{u:()=>xe});var r=n(42537),i=n(70758),s=n(80987),o=n(94172),a=n(27366),l=n(7138),c=n(49861),d=(n(25243),n(63780),n(93169),n(69912));let u=class extends l.Z{constructor(e){super(e),this.layer=null,this.enabled=!0,this.updating=!1,this.availability=1}};(0,a._)([(0,c.Cb)({constructOnly:!0})],u.prototype,"layer",void 0),(0,a._)([(0,c.Cb)()],u.prototype,"enabled",void 0),(0,a._)([(0,c.Cb)()],u.prototype,"updating",void 0),(0,a._)([(0,c.Cb)()],u.prototype,"availability",void 0),u=(0,a._)([(0,d.j)("esri.views.interactive.snapping.FeatureSnappingLayerSource")],u);const h=u;var p=n(76014);let f=class extends l.Z{constructor(e){super(e),this.enabled=!1,this.enabledToggled=!1,this.selfEnabled=!0,this.featureEnabled=!0,this.featureSources=new s.Z,this.distance=p.c.distance,this.touchSensitivityMultiplier=p.c.touchSensitivityMultiplier}get effectiveEnabled(){return this.enabledToggled?!this.enabled:this.enabled}get effectiveSelfEnabled(){return this.effectiveEnabled&&this.selfEnabled}get effectiveFeatureEnabled(){return this.effectiveEnabled&&this.featureEnabled}};(0,a._)([(0,c.Cb)()],f.prototype,"enabled",void 0),(0,a._)([(0,c.Cb)()],f.prototype,"enabledToggled",void 0),(0,a._)([(0,c.Cb)()],f.prototype,"selfEnabled",void 0),(0,a._)([(0,c.Cb)()],f.prototype,"featureEnabled",void 0),(0,a._)([(0,c.Cb)({type:s.Z.ofType(h)})],f.prototype,"featureSources",void 0),(0,a._)([(0,c.Cb)()],f.prototype,"distance",void 0),(0,a._)([(0,c.Cb)()],f.prototype,"touchSensitivityMultiplier",void 0),(0,a._)([(0,c.Cb)({readOnly:!0})],f.prototype,"effectiveEnabled",null),(0,a._)([(0,c.Cb)({readOnly:!0})],f.prototype,"effectiveSelfEnabled",null),(0,a._)([(0,c.Cb)({readOnly:!0})],f.prototype,"effectiveFeatureEnabled",null),f=(0,a._)([(0,d.j)("esri.views.interactive.snapping.SnappingOptions")],f);const g=f;var _=n(66978),v=n(68860),y=n(88396),m=n(11186),w=n(71353),S=n(26277),E=n(46634),b=n(74509),x=n(44179),P=n(38054),R=n(32718),C=n(76672),T=n(18661),D=n(87072),O=n(37933),L=n(64674);let A=class extends l.Z{get layerView(){var e;return null===(e=this.view)||void 0===e||null===(e=e.allLayerViews)||void 0===e?void 0:e.find((e=>e.layer===this.layer))}get valid(){return this._valid}get subtypeFilter(){var e,t,n;const{layer:r}=this;if(!(0,O.e9)(r)||null===(e=r.subtypes)||void 0===e||!e.length)return{mode:"not-in-use",filter:null};const i=null!==(t=null===(n=r.fieldsIndex.get(r.subtypeField))||void 0===n?void 0:n.name)&&void 0!==t?t:r.subtypeField,s=r.sublayers.filter((e=>e.visible)).map((e=>e.subtypeCode));return s.length?s.length===r.subtypes.length?{mode:"all-visible",filter:null}:1===s.length?{mode:"in-use",filter:"".concat(i," = ").concat(s.getItemAt(0))}:{mode:"in-use",filter:"".concat(i," IN (").concat(s.join(", "),")")}:{mode:"none-visible",filter:null}}get floorFilter(){const{view:e,layer:t}=this;return e&&t?(0,D.c)({view:e,layer:t}):null}constructor(e){super(e),this.rulesTable=null,this._valid=!1}initialize(){if(!this.snappingSource||!this.layer)return;const{layer:e,snappingSource:t}=this;if("refresh"in e){const n=e;this.addHandles(n.on("refresh",(()=>t.refresh())))}this.loadRules(),this.addHandles([(0,o.YP)((()=>t.updating),(e=>t.layerSource.updating=e),o.tX),(0,o.YP)((()=>t.availability),(e=>t.layerSource.availability=e),o.tX)])}getFetchCandidatesParameters(e,t,n){var r,i;if(!this.valid)return[];const{layer:s,layerView:o,floorFilter:a,rulesTable:l,subtypeFilter:c}=this,d={distance:n,mode:null!==(r=null===(i=this.view)||void 0===i?void 0:i.type)&&void 0!==r?r:"2d",point:e,coordinateHelper:t.coordinateHelper,...this._types,filter:o&&"filter"in o?o.filter:null};if(a&&(d.filter=j(d.filter,a)),"not-in-use"!==c.mode&&"all-visible"!==c.mode){if("none-visible"===c.mode)return[];d.filter?d.filter.where=(0,C._)(d.filter.where,c.mode):d.filter=new T.Z({where:c.filter})}if(l){var u;const e=t.feature,n=null===e||void 0===e?void 0:e.sourceLayer;if(!(e&&(0,O.Te)(s)&&s.layerId&&(0,O.Te)(n)&&"loaded"===l.loadStatus))return[];const r=[],i=s.layerId,o=null===(u=l.getFeatureSQL(n,e))||void 0===u?void 0:u[i];if(!o)return[];const a=o.anyVertex;let c=o.endVertex;return c&&a&&c===a&&(c=""),c&&r.push({...d,returnEdge:!1,vertexMode:"ends",filter:j(d.filter,c)}),a&&r.push({...d,returnEdge:!1,vertexMode:"all",filter:j(d.filter,a)}),r}return[d]}async loadRules(){const{layer:e,view:t}=this;if(e&&t&&(0,L.n0)(null===t||void 0===t?void 0:t.map)&&(0,O.Te)(e)){var n;const i=null===(n=t.map.utilityNetworks)||void 0===n?void 0:n.find((t=>t.isUtilityLayer(e)));if(i)try{var r;this.rulesTable=await i.getRulesTable(),await(null===(r=this.rulesTable)||void 0===r?void 0:r.load()),this._valid=!0}catch(fe){return void R.Z.getLogger("esri.views.interactive.snapping.FeatureSnappingSourceInfo").error("Failed to load rules table for snapping source",e.title)}}else this._valid=!0}get _types(){return{returnEdge:!0,vertexMode:"all"}}remove(){this.destroy()}destroy(){var e;null===(e=this.snappingSource)||void 0===e||e.destroy()}};function j(e,t){return null==e?new T.Z({where:t}):e.where?new T.Z({where:(0,C._)(e.where,t)}):new T.Z({where:t})}(0,a._)([(0,c.Cb)({constructOnly:!0})],A.prototype,"layer",void 0),(0,a._)([(0,c.Cb)({constructOnly:!0})],A.prototype,"snappingSource",void 0),(0,a._)([(0,c.Cb)({constructOnly:!0})],A.prototype,"view",void 0),(0,a._)([(0,c.Cb)()],A.prototype,"layerView",null),(0,a._)([(0,c.Cb)()],A.prototype,"rulesTable",void 0),(0,a._)([(0,c.Cb)()],A.prototype,"valid",null),(0,a._)([(0,c.Cb)()],A.prototype,"subtypeFilter",null),(0,a._)([(0,c.Cb)()],A.prototype,"floorFilter",null),(0,a._)([(0,c.Cb)()],A.prototype,"_valid",void 0),A=(0,a._)([(0,d.j)("esri.views.interactive.snapping.FeatureSnappingSourceInfo")],A);var F,G=n(80371),I=n(97760),M=n(95905),N=n(75691),V=n(92605),z=n(53397),k=n(41216);class q extends V.j{constructor(e){let{targetPoint:t,constraint:n,previousVertex:r,otherVertex:i,otherVertexType:s,objectId:o,isDraped:a}=e;super(t,n,a,G.B.SELF),this.previousVertex=r,this.otherVertex=i,this.otherVertexType=s,this.objectId=o}get hints(){const e=this.previousVertex,t=this.otherVertexType===F.CENTER?this.otherVertex:this.targetPoint,n=this.otherVertexType===F.CENTER?this.targetPoint:this.otherVertex;return[new z.w(L.ze.TARGET,t,n,this.isDraped,this.domain),new z.w(L.ze.REFERENCE,e,t,this.isDraped,this.domain),new k.y(this.previousVertex,t,n,this.isDraped,this.domain)]}}!function(e){e[e.NEXT=0]="NEXT",e[e.CENTER=1]="CENTER"}(F||(F={}));var H=n(11208);let U=class extends l.Z{get updating(){return this._snappingSources.some((e=>null==e||e.valid&&e.snappingSource.updating))||this._updatingHandles.updating}constructor(e){super(e),this.options=null,this._domain=G.B.FEATURE,this._updatingHandles=new E.R,this._sourceModules={featureService:{module:null,loader:null},featureCollection:{module:null,loader:null},graphics:{module:null,loader:null},notes:{module:null,loader:null},scene:{module:null,loader:null}}}initialize(){const e=(0,o.TP)((()=>{var e;return null===(e=this.options)||void 0===e?void 0:e.featureSources}),((e,t)=>this._createSourceInfo(e,t)));this._snappingSources=e,this.addHandles((0,r.ed)(e))}destroy(){this._set("options",null),this._updatingHandles.destroy()}async fetchCandidates(e,t,n,r){if(!(t&this._domain&&null!=this.options&&this.options.effectiveFeatureEnabled))return[];const i=[],s=this._computeScreenSizeDistanceParameters(e,n);for(const l of this._snappingSources){var o;if(null==l||!l.valid||!l.snappingSource.layerSource.enabled||null!==(o=l.layerView)&&void 0!==o&&o.suspended)continue;const t=l.getFetchCandidatesParameters(e,n,s);for(const e of t)i.push(l.snappingSource.fetchCandidates(e,r).then((e=>e.filter((e=>!this._candidateIsExcluded(l.snappingSource,e,n.excludeFeature))))))}const a=(await(0,_.OT)(i)).flat();return this._addRightAngleCandidates(a,e,s,n),(0,_.k_)(r),(0,L.lQ)(e,a),a}_addRightAngleCandidates(e,t,n,r){var i,s,o,a;const l=null!=r.vertexHandle?null===(i=r.vertexHandle.rightEdge)||void 0===i||null===(i=i.rightVertex)||void 0===i?void 0:i.pos:null!=r.editGeometryOperations&&"polygon"===r.editGeometryOperations.data.type?null===(s=r.editGeometryOperations.data.components[0])||void 0===s||null===(s=s.getFirstVertex())||void 0===s?void 0:s.pos:null,c=null!=r.vertexHandle?null===(o=r.vertexHandle.leftEdge)||void 0===o||null===(o=o.leftVertex)||void 0===o?void 0:o.pos:null!=r.editGeometryOperations?null===(a=r.editGeometryOperations.data.components[0])||void 0===a||null===(a=a.getLastVertex())||void 0===a?void 0:a.pos:null,{view:d}=this,u=(0,P.j7)(l,d,r),h=(0,P.j7)(c,d,r),p=e.length;for(let f=0;f<p;f++)this._addRightAngleCandidate(e[f],h,t,n,e),this._addRightAngleCandidate(e[f],u,t,n,e)}_addRightAngleCandidate(e,t,n,r,i){if(null==t||!function(e){return(e instanceof M.L||e instanceof I.k)&&!function(e){let{constraint:{start:t,end:n}}=e;const r=(0,m.a)(t,n),i=(0,y.k)(t,n);return r<(0,S.g)()||i/r<B}(e)}(e))return;const s=e.constraint.closestTo(t),o=(s[0]-n[0])/r.x,a=(s[1]-n[1])/r.y,{start:l,end:c}=e.constraint;if(o*o+a*a<=1){const n=new q({targetPoint:s,otherVertex:t,otherVertexType:F.NEXT,previousVertex:(0,y.k)(s,l)>(0,y.k)(s,c)?l:c,constraint:new x.aU(t,s),objectId:e.objectId,isDraped:e.isDraped});i.push(n)}}_computeScreenSizeDistanceParameters(e,t){let n=null!=this.options?this.options.distance*("touch"===t.pointer?this.options.touchSensitivityMultiplier:1):0;return null==this.view?{x:n,y:n,z:n,distance:n}:"2d"===this.view.type?(n*=this.view.resolution,{x:n,y:n,z:n,distance:n}):this._computeScreenSizeDistanceParameters3D(e,n,this.view,t)}_computeScreenSizeDistanceParameters3D(e,t,n,r){const{spatialReference:i}=r;n.renderCoordsHelper.toRenderCoords(e,i,W);const s=n.state.camera.computeScreenPixelSizeAt(W),o=s*n.renderCoordsHelper.unitInMeters,a=o/(0,v.c9)(i),l=o/(0,v._R)(i),c=t*a,d=t*l,u=(0,H.Rs)(e,i,b.jG,n),h=u?Z(u,e,a,0,0,n,r):0,p=u?Z(u,e,0,a,0,n,r):0,f=u?Z(u,e,0,0,l,n,r):0;return{x:0===h?0:c/h,y:0===p?0:c/p,z:0===f?0:d/f,distance:s*t}}_candidateIsExcluded(e,t,n){if(null==n)return!1;const r=this._getCandidateObjectId(t);if(null==r)return!1;const i=e.layerSource.layer;return"graphics"===i.type?n.uid===r:n.sourceLayer===i&&!(!n.attributes||!("objectIdField"in i))&&n.attributes[i.objectIdField]===r}_getCandidateObjectId(e){return e instanceof N.a?e.objectId:null}async _createSourceInfo(e,t){const n=e.layer;n.loaded||(await n.load(),(0,_.k_)(t));const{view:r}=this,i=await this._createFeatureSnappingSourceType(e);return(0,_.k_)(t),new A(null==i?{}:{snappingSource:i,view:r,layer:n})}async _createFeatureSnappingSourceType(e){switch(e.layer.type){case"feature":case"geojson":case"csv":case"oriented-imagery":case"subtype-group":case"wfs":return this._createFeatureSnappingSourceFeatureLayer(e);case"graphics":return this._createFeatureSnappingSourceGraphicsLayer(e);case"map-notes":return this._createFeatureSnappingSourceMapNotesLayer(e);case"scene":case"building-scene":return this._createFeatureSnappingSourceSceneLayer(e)}return null}async _createFeatureSnappingSourceSceneLayer(e){const{view:t}=this;return null==t||"3d"!==t.type?null:new((await this._getSourceModule("scene")).SceneLayerSnappingSource)({layerSource:e,view:t})}async _createFeatureSnappingSourceFeatureLayer(e){var t;switch(null===(t=e.layer.source)||void 0===t?void 0:t.type){case"feature-layer":case"oriented-imagery":return new((await this._getSourceModule("featureService")).FeatureServiceSnappingSource)({spatialReference:this.spatialReference,view:this.view,layerSource:e});case"memory":case"csv":case"geojson":case"wfs":return"mesh"===e.layer.geometryType?null:new((await this._getSourceModule("featureCollection")).FeatureCollectionSnappingSource)({layerSource:e,view:this.view})}return null}async _createFeatureSnappingSourceGraphicsLayer(e){return new((await this._getSourceModule("graphics")).GraphicsSnappingSource)({getGraphicsLayers:()=>[e.layer],spatialReference:this.spatialReference,view:this.view,layerSource:e})}async _createFeatureSnappingSourceMapNotesLayer(e){return new((await this._getSourceModule("notes")).GraphicsSnappingSource)({getGraphicsLayers:()=>{var t,n;return null!==(t=null===(n=e.layer.sublayers)||void 0===n?void 0:n.toArray())&&void 0!==t?t:[]},spatialReference:this.spatialReference,view:this.view,layerSource:e})}async _getSourceModule(e){const t=this._sourceModules[e];if(null==t.loader){const t=this._loadSourceModule(e),n={module:null,loader:t};this._sourceModules[e]=n;const r=await t,i={module:r,loader:t};return this._sourceModules[e]=i,r}return null==t.module?t.loader:t.module}_loadSourceModule(e){const t=this._updatingHandles;switch(e){case"featureService":return t.addPromise(n.e(5532).then(n.bind(n,5532)));case"featureCollection":return t.addPromise(n.e(2137).then(n.bind(n,26823)));case"graphics":case"notes":return t.addPromise(Promise.all([n.e(4054),n.e(5026),n.e(5281),n.e(3066),n.e(8928),n.e(3518)]).then(n.bind(n,33518)));case"scene":return t.addPromise(n.e(2767).then(n.bind(n,92767)))}}get test(){return{snappingSources:this._snappingSources}}};function Z(e,t,n,r,i,s,o){let{spatialReference:a}=o;const l=(0,m.c)(Y,t);l[0]+=n,l[1]+=r,l[2]+=i;const c=(0,H.Rs)(l,a,b.jG,s);return c?(0,L.fG)(c,e):1/0}(0,a._)([(0,c.Cb)({constructOnly:!0})],U.prototype,"spatialReference",void 0),(0,a._)([(0,c.Cb)({constructOnly:!0})],U.prototype,"view",void 0),(0,a._)([(0,c.Cb)()],U.prototype,"options",void 0),(0,a._)([(0,c.Cb)({readOnly:!0})],U.prototype,"updating",null),(0,a._)([(0,c.Cb)()],U.prototype,"_snappingSources",void 0),U=(0,a._)([(0,d.j)("esri.views.interactive.snapping.FeatureSnappingEngine")],U);const W=(0,w.c)(),Y=(0,w.c)(),B=1e-4;var J=n(91505),X=n(79803);class K{constructor(e,t){this.view=e,this.options=t,this.squaredShortLineThreshold=p.c.shortLineThreshold*p.c.shortLineThreshold}snap(e,t){return null!=t.vertexHandle?"vertex"!==t.vertexHandle.type?[]:this.snapExistingVertex(e,t):this.snapNewVertex(e,t)}edgeExceedsShortLineThreshold(e,t){return this.exceedsShortLineThreshold((0,P.j7)(e.leftVertex.pos,this.view,t),(0,P.j7)(e.rightVertex.pos,this.view,t),t)}exceedsShortLineThreshold(e,t,n){let{spatialReference:r}=n;return 0===this.squaredShortLineThreshold||(0,L.Bb)((0,H.Rs)(t,r,b.jG,this.view),(0,H.Rs)(e,r,b.jG,this.view))>this.squaredShortLineThreshold}isVertical(e,t){return(0,y.k)(e,t)<p.c.verticalLineThreshold}squaredProximityThreshold(e){return"touch"===e?this._squaredTouchProximityThreshold:this._squaredMouseProximityThreshold}get _squaredMouseProximityThreshold(){return this.options.distance*this.options.distance}get _squaredTouchProximityThreshold(){const{distance:e,touchSensitivityMultiplier:t}=this.options,n=e*t;return n*n}}class $ extends V.j{constructor(e){let{lineStart:t,lineEnd:n,targetPoint:r,isDraped:i}=e;super(r,new x.jg(t,n),i,G.B.SELF),this._referenceLineHint=new z.w(L.ze.REFERENCE_EXTENSION,t,n,i,this.domain)}get hints(){return[this._referenceLineHint,new z.w(L.ze.TARGET,this._lineEndClosestToTarget(),this.targetPoint,this.isDraped,this.domain)]}_lineEndClosestToTarget(){return this.constraint.closestEndTo(this.targetPoint)}}var Q=n(55793),ee=n(94163);class te extends K{snapNewVertex(e,t){const n=t.editGeometryOperations.data.components[0],r=n.edges.length,i=[];if(r<1)return i;const{spatialReference:s}=t,o=(0,H.Rs)(e,s,b.jG,this.view),{view:a}=this,l=n.edges[r-1];let c=l;do{if(this.edgeExceedsShortLineThreshold(c,t)){const n=(0,L._j)(c,a,t);this._processCandidateProposal(n.left,n.right,e,o,t,i)}c=c.leftVertex.leftEdge}while(c&&c!==l);return i}snapExistingVertex(e,t){const n=[],r=t.vertexHandle,i=r.component;if(i.edges.length<2)return n;const{view:s}=this,{spatialReference:o}=t,a=(0,H.Rs)(e,o,b.jG,s),l=r.leftEdge,c=r.rightEdge;l&&c&&this.edgeExceedsShortLineThreshold(l,t)&&this.edgeExceedsShortLineThreshold(c,t)&&this._processCandidateProposal((0,P.j7)(l.leftVertex.pos,s,t),(0,P.j7)(c.rightVertex.pos,s,t),e,a,t,n);const d=i.edges[0];let u=d;do{if(u!==r.leftEdge&&u!==r.rightEdge&&this.edgeExceedsShortLineThreshold(u,t)){const r=(0,L._j)(u,s,t);this._processCandidateProposal(r.left,r.right,e,a,t,n)}u=u.rightVertex.rightEdge}while(u&&u!==d);return n}_processCandidateProposal(e,t,n,r,i,s){var o;const{spatialReference:a,pointer:l}=i,c=(0,P.uo)((0,Q.ZE)(n,{start:e,end:t,type:ee.SP.LINE}));(0,L.Bb)(r,(0,H.Rs)(c,a,b.jG,this.view))<this.squaredProximityThreshold(l)&&s.push(new $({lineStart:e,lineEnd:t,targetPoint:c,isDraped:"on-the-ground"===(null===(o=i.elevationInfo)||void 0===o?void 0:o.mode)}))}}var ne=n(6394),re=n(5916);class ie extends V.j{constructor(e){let{referenceLine:t,lineStart:n,targetPoint:r,isDraped:i}=e;const s=(0,w.g)(n),{left:o,right:a}=t;(0,m.f)(s,(0,m.g)(s,s,a),o),super(r,new x.jg(n,(0,P.uo)(s)),i,G.B.SELF),this._referenceLines=[{edge:t,fadeLeft:!0,fadeRight:!0}]}get hints(){return[new z.w(L.ze.TARGET,this.constraint.start,this.targetPoint,this.isDraped,this.domain),new re.L(this.constraint.start,this.targetPoint,this.isDraped,this.domain),...this._referenceLines.map((e=>new z.w(L.ze.REFERENCE,e.edge.left,e.edge.right,this.isDraped,this.domain,e.fadeLeft,e.fadeRight)))]}addReferenceLine(e){const t={edge:e,fadeLeft:!0,fadeRight:!0};this._referenceLines.forEach((n=>{(0,m.h)(e.right,n.edge.left)&&(n.fadeLeft=!1,t.fadeRight=!1),(0,m.h)(e.right,n.edge.right)&&(n.fadeRight=!1,t.fadeRight=!1),(0,m.h)(e.left,n.edge.right)&&(n.fadeRight=!1,t.fadeLeft=!1),(0,m.h)(e.left,n.edge.left)&&(n.fadeLeft=!1,t.fadeLeft=!1)})),this._referenceLines.push(t)}}class se extends K{snapNewVertex(e,t){const n=t.editGeometryOperations.data.components[0],r=n.edges.length,i=n.vertices.length,s=[];if(r<2)return s;const{view:o}=this,a=(0,H.Rs)(e,t.spatialReference,b.jG,o),l=(0,P.j7)(n.vertices[i-1].pos,o,t),c=(0,P.j7)(n.vertices[0].pos,o,t),d=n.edges[r-1];let u=d;do{if(this.edgeExceedsShortLineThreshold(u,t)){const n=(0,L._j)(u,o,t);this._checkEdgeForParallelLines(n,l,e,a,t,s),this._checkEdgeForParallelLines(n,c,e,a,t,s)}u=u.leftVertex.leftEdge}while(u&&u!==d);return s}snapExistingVertex(e,t){const n=[],r=t.vertexHandle,i=r.component;if(i.edges.length<3)return n;const{view:s}=this,o=(0,H.Rs)(e,t.spatialReference,b.jG,s),a=r.leftEdge,l=r.rightEdge,c=i.vertices[0],d=(0,P.j7)(c.pos,s,t),u=i.vertices.length,h=i.vertices[u-1],p=(0,P.j7)(h.pos,s,t),f=i.edges[0];let g=f;do{if(g!==a&&g!==l&&this.edgeExceedsShortLineThreshold(g,t)){const i=(0,L._j)(g,s,t);a&&this._checkEdgeForParallelLines(i,(0,P.j7)(a.leftVertex.pos,s,t),e,o,t,n),l&&this._checkEdgeForParallelLines(i,(0,P.j7)(l.rightVertex.pos,s,t),e,o,t,n),r===c?this._checkEdgeForParallelLines(i,p,e,o,t,n):r===h&&this._checkEdgeForParallelLines(i,d,e,o,t,n)}g=g.rightVertex.rightEdge}while(g&&g!==f);return n}_checkEdgeForParallelLines(e,t,n,r,i,s){const o=e.left,a=e.right;if((0,ee.k0)(oe,t,o,a),(0,y.k)(oe,t)<p.c.parallelLineThreshold)return;(0,ee.k0)(oe,n,o,a,t);const{spatialReference:l,pointer:c}=i,d=(0,P.al)(oe[0],oe[1],n[2]);if((0,L.Bb)(r,(0,H.Rs)(d,l,b.jG,this.view))<this.squaredProximityThreshold(c)){var u;if(this.isVertical(d,t)||this.isVertical(o,a))return;if(this._parallelToPreviousCandidate(e,s))return;s.push(new ie({referenceLine:e,lineStart:t,targetPoint:d,isDraped:"on-the-ground"===(null===(u=i.elevationInfo)||void 0===u?void 0:u.mode)}))}}_parallelToPreviousCandidate(e,t){const n=e.left,r=e.right;for(const i of t)if((0,ee.k0)(oe,r,i.constraint.start,i.constraint.end,n),(0,y.k)(oe,r)<p.c.parallelLineThreshold)return i.addReferenceLine(e),!0;return!1}}const oe=(0,ne.a)();class ae extends K{snapNewVertex(e,t){const n=t.editGeometryOperations.data.components[0],r=n.vertices.length,i=[];if(r<2)return i;const{view:s}=this,o=(0,H.Rs)(e,t.spatialReference,b.jG,s),a=n.vertices[r-1];if(this.edgeExceedsShortLineThreshold(a.leftEdge,t)){const n=(0,P.j7)(a.pos,s,t),r=(0,P.j7)(a.leftEdge.leftVertex.pos,s,t);this._checkForSnappingCandidate(i,r,n,e,o,t)}const l=n.vertices[0];if(this.edgeExceedsShortLineThreshold(l.rightEdge,t)){const n=(0,P.j7)(l.pos,s,t),r=(0,P.j7)(l.rightEdge.rightVertex.pos,s,t);this._checkForSnappingCandidate(i,r,n,e,o,t)}return i}snapExistingVertex(e,t){const n=[],r=t.vertexHandle;if(r.component.vertices.length<3)return n;const{view:i}=this,s=(0,H.Rs)(e,t.spatialReference,b.jG,i),o=r.leftEdge,a=r.rightEdge;if(null!==o&&void 0!==o&&o.leftVertex.leftEdge){const r=o.leftVertex.leftEdge;if(this.edgeExceedsShortLineThreshold(r,t)){const o=(0,P.j7)(r.rightVertex.pos,i,t),a=(0,P.j7)(r.leftVertex.pos,i,t);this._checkForSnappingCandidate(n,a,o,e,s,t)}}if(null!==a&&void 0!==a&&a.rightVertex.rightEdge){const r=a.rightVertex.rightEdge;if(this.edgeExceedsShortLineThreshold(r,t)){const o=(0,P.j7)(r.leftVertex.pos,i,t),a=(0,P.j7)(r.rightVertex.pos,i,t);this._checkForSnappingCandidate(n,a,o,e,s,t)}}return n}_checkForSnappingCandidate(e,t,n,r,i,s){const{spatialReference:o,pointer:a}=s;(0,y.c)(le,n,t);const l=(0,m.s)(ce,le[1],-le[0],0),c=(0,y.g)(l,(0,y.c)(le,r,n))/(0,y.v)(l),d=(0,P.uo)((0,y.w)((0,w.g)(r),n,l,c));if((0,L.Bb)(i,(0,H.Rs)(d,o,b.jG,this.view))<this.squaredProximityThreshold(a)){var u;if(this.isVertical(d,n)||this.isVertical(n,t))return;const r=(0,m.q)((0,w.c)(),n,l,Math.sign(c));e.push(new q({targetPoint:d,constraint:new x.aU(n,(0,P.uo)(r)),previousVertex:t,otherVertex:n,otherVertexType:F.CENTER,isDraped:"on-the-ground"===(null===(u=s.elevationInfo)||void 0===u?void 0:u.mode)}))}}}const le=(0,ne.a)(),ce=(0,w.c)();class de extends V.j{constructor(e){let{targetPoint:t,point1:n,point2:r,isDraped:i}=e;super(t,new x.kt((0,P.uo)((0,m.p)((0,w.c)(),n,r,.5)),.5*(0,y.d)(n,r)),i,G.B.SELF),this._p1=n,this._p2=r}get hints(){return[new z.w(L.ze.REFERENCE,this.targetPoint,this._p1,this.isDraped,this.domain),new z.w(L.ze.REFERENCE,this.targetPoint,this._p2,this.isDraped,this.domain),new k.y(this._p1,this.targetPoint,this._p2,this.isDraped,this.domain)]}}class ue extends K{snapNewVertex(e,t){const n=t.editGeometryOperations.data.components[0],r=[],i=n.vertices.length;if("polygon"!==t.editGeometryOperations.data.type||i<2)return r;const{view:s}=this,o=n.vertices[0],a=n.vertices[i-1],l=(0,P.j7)(o.pos,s,t),c=(0,P.j7)(a.pos,s,t);return this._processCandidateProposal(l,c,e,t,r),r}snapExistingVertex(e,t){const n=[],r=t.vertexHandle,i=r.component;if(i.edges.length<2)return n;if("polyline"===t.editGeometryOperations.data.type&&(0===r.index||r.index===i.vertices.length-1))return n;const{view:s}=this,o=(0,P.j7)(r.leftEdge.leftVertex.pos,s,t),a=(0,P.j7)(r.rightEdge.rightVertex.pos,s,t);return this._processCandidateProposal(o,a,e,t,n),n}_processCandidateProposal(e,t,n,r,i){if(!this.exceedsShortLineThreshold(e,t,r))return;const s=(0,y.l)(he,e,t,.5),o=.5*(0,y.d)(e,t),a=(0,w.c)();(0,ee.xO)(a,n,s,o),a[2]=n[2];const l=(0,P.uo)(a),{spatialReference:c,pointer:d}=r,u=(0,H.Rs)(n,c,b.jG,this.view);if((0,L.Bb)(u,(0,H.Rs)(l,c,b.jG,this.view))<this.squaredProximityThreshold(d)){var h;if(this.isVertical(e,l)||this.isVertical(l,t))return;i.push(new de({targetPoint:l,point1:e,point2:t,isDraped:"on-the-ground"===(null===(h=r.elevationInfo)||void 0===h?void 0:h.mode)}))}}}const he=(0,ne.a)();let pe=class extends l.Z{constructor(e){super(e),this.updating=!1,this._snappers=new s.Z,this._domain=G.B.SELF}initialize(){this._snappers.push(new se(this.view,this.options),new te(this.view,this.options),new ae(this.view,this.options),new ue(this.view,this.options))}set options(e){this._set("options",e);for(const t of this._snappers)t.options=e}async fetchCandidates(e,t,n){if(!(t&this._domain&&this.options.effectiveSelfEnabled))return[];const r=[];for(const i of this._snappers.items)for(const t of i.snap(e,n))r.push(t);return(0,L.lQ)(e,r),r}};function fe(e,t){return[new pe({view:e,options:t}),new U({view:e,options:t,spatialReference:e.spatialReference})]}(0,a._)([(0,c.Cb)({readOnly:!0})],pe.prototype,"updating",void 0),(0,a._)([(0,c.Cb)({constructOnly:!0})],pe.prototype,"view",void 0),(0,a._)([(0,c.Cb)()],pe.prototype,"options",null),pe=(0,a._)([(0,d.j)("esri.views.interactive.snapping.SelfSnappingEngine")],pe);var ge=n(55946);function _e(e,t,n){var r;let{z:i,m:s,spatialReference:o,elevationInfo:a}=n;if(null==i&&null==s){const t=(0,ge.T)(e[0],e[1],void 0,o);return null!=s&&(t.m=s,t.hasM=!0),t}if(null==t||"2d"===t.type){const t=(0,ge.T)(e[0],e[1],i,o);return null!=s&&(t.m=s,t.hasM=!0),t}const l=null!==(r=(0,b.zx)(t,e,o,b.jG,a))&&void 0!==r?r:0,c=(0,ge.T)(e[0],e[1],l,o);return null!=s&&(c.m=s,c.hasM=!0),c}var ve=n(90609);class ye extends V.j{constructor(e,t,n,r){super(e,new x.Hk(e),r,G.B.ALL),this.first=t,this.second=n}get hints(){return this.first.targetPoint=this.targetPoint,this.second.targetPoint=this.targetPoint,[...this.first.hints,...this.second.hints,new ve.w(this.targetPoint,this.isDraped,this.domain)]}}let me=class extends(J.Z.EventedMixin(l.Z)){constructor(e){super(e),this.options=new g,this.snappingEnginesFactory=fe,this._engines=[],this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=we.MAIN}initialize(){this.addHandles([(0,o.YP)((()=>{const{effectiveFeatureEnabled:e,effectiveSelfEnabled:t,touchSensitivityMultiplier:n,distance:r}=this.options;return{effectiveFeatureEnabled:e,effectiveSelfEnabled:t,touchSensitivityMultiplier:n,distance:r}}),(()=>{this.doneSnapping(),this.emit("changed")}),o.Z_),(0,o.YP)((()=>this.options),(e=>{for(const t of this._engines)t.options=e}),o.Z_),(0,o.YP)((()=>({viewReady:this.view.ready,viewSpatialReference:this.view.spatialReference,snappingEnginesFactory:this.snappingEnginesFactory})),(e=>{let{viewReady:t,snappingEnginesFactory:n}=e;return this._recreateEngines(t,n)}),o.tX)])}destroy(){this._destroyEngines()}get updating(){return this._engines.some((e=>e.updating))}_recreateEngines(e,t){if(this._destroyEngines(),!e)return;const{view:n,options:r}=this;this._engines=t(n,r)}_destroyEngines(){for(const e of this._engines)e.destroy();this._engines=[]}get _squaredMouseProximityTreshold(){return this.options.distance*this.options.distance}get _squaredTouchProximityThreshold(){const{distance:e,touchSensitivityMultiplier:t}=this.options,n=e*t;return n*n}get _squaredSatisfiesConstraintThreshold(){return p.c.satisfiesConstraintScreenThreshold*p.c.satisfiesConstraintScreenThreshold}snap(e){return function(e){return null!=e.scenePoint}(e)?this._snapMultiPoint(e):this._snapSinglePoint(e)}update(e){const{point:t,context:n}=e;this._removeVisualization();const r=this._currentMainCandidate;if(null==r)return t;const i=this._selectUpdateInput(e);if(null==i)return t;const{spatialReference:s}=n,o=(0,X.project)(i,s);if(null==o)return t;const{view:a}=this,{elevationInfo:l,visualizer:c}=n,d=[],u=(0,P.SN)(o,a,l),h=r.constraint.closestTo(u);if(!this._arePointsWithinScreenThreshold(u,h,n))return this._resetSnappingState(),t;r.targetPoint=h,d.push(...r.hints);for(const p of this._currentOtherActiveCandidates)p.targetPoint=h,d.push(...p.hints);return null!=c&&this.addHandles(c.draw(d,{spatialReference:s,elevationInfo:Ee(n),view:a,selfSnappingZ:n.selfSnappingZ}),Se),_e(h,a,{z:t.z,m:t.m,spatialReference:t.spatialReference,elevationInfo:l})}doneSnapping(){this._removeVisualization(),this._resetSnappingState()}_selectUpdateInput(e){let{point:t,scenePoint:n}=e;switch(this._currentSnappedType){case we.MAIN:return t;case we.SCENE:return n}}_resetSnappingState(){this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=we.MAIN}_removeVisualization(){this.removeHandles(Se)}async _snapSinglePoint(e){let{point:t,context:n,signal:r}=e;const{view:i}=this,{elevationInfo:s}=n,o=(0,P.SN)(t,i,s),a=await this._fetchCandidates(o,G.B.ALL,n,r);return this._createSnapResult(o,we.MAIN,a,i,n,{z:t.z,m:t.m,spatialReference:t.spatialReference,elevationInfo:s},r)}async _snapMultiPoint(e){var t,n;let{point:r,scenePoint:i,context:s,signal:o}=e;const{view:a}=this,{coordinateHelper:l,elevationInfo:c,spatialReference:d}=s;await(0,X.initializeProjection)(i.spatialReference,d);const u=(0,X.project)(i,d),h=(0,P.SN)(u,a,c),p=await this._fetchCandidates(h,G.B.FEATURE,s,o);if(p.length>0){const e=await this._fetchCandidates(h,G.B.SELF,s,o);return this._createSnapResult(h,we.SCENE,[...p,...e],a,s,{z:u.z,m:u.m,spatialReference:u.spatialReference,elevationInfo:c},o)}const f=(0,P.SN)(r,a,c),g=await this._fetchCandidates(f,G.B.SELF,s,o);return this._createSnapResult(f,we.MAIN,g,a,s,{z:l.hasZ()&&r.hasZ?null!==(t=r.z)&&void 0!==t?t:0:void 0,m:l.hasM()&&r.hasM?null!==(n=r.m)&&void 0!==n?n:0:void 0,spatialReference:r.spatialReference,elevationInfo:c},o)}async _fetchCandidates(e,t,n,r){return(await Promise.all(this._engines.map((i=>i.fetchCandidates(e,t,n,r))))).flat()}_createSnapResult(e,t,n,r,i,s,o){return{get valid(){return!(0,_.Hc)(o)},apply:()=>{const{spatialReference:o}=i,{snappedPoint:a,hints:l}=this._processCandidates(e,t,n,i);return this._removeVisualization(),null!=i.visualizer&&this.addHandles(i.visualizer.draw(l,{spatialReference:o,elevationInfo:b.jG,view:r,selfSnappingZ:i.selfSnappingZ}),Se),_e(a,r,s)}}}_processCandidates(e,t,n,r){if(n.length<1)return this.doneSnapping(),{snappedPoint:e,hints:[]};this._currentSnappedType!==t&&this._resetSnappingState(),(0,L.lQ)(e,n);const i=this._currentMainCandidate;if(null!=i){const s=this._findOldConstraintInNewCandidates(i,n);if(s>=0){if(!(n[s]instanceof ye))return this._intersectWithOtherCandidates(s,n,e,t,r);if(this._arePointsWithinScreenThreshold(e,i.targetPoint,r))return this._updateSnappingCandidate(i,t,n,r)}}return this._intersectWithOtherCandidates(0,n,e,t,r)}_findOldConstraintInNewCandidates(e,t){return e instanceof ye?this._findOldCandidateIndex(t,e.first)>=0&&this._findOldCandidateIndex(t,e.second)>=0?0:-1:this._findOldCandidateIndex(t,e)}_intersectWithOtherCandidates(e,t,n,r,i){const{coordinateHelper:s}=i,o=t[e],a=[];for(let l=0;l<t.length;++l){if(l===e)continue;const r=t[l],i=o.constraint.intersect(r.constraint);if(i)for(const e of i.closestPoints(o.targetPoint))a.push([new ye(e,o,r,r.isDraped),this._squaredScreenDistance(n,e,s)])}return a.length>0&&(a.sort(((e,t)=>e[1]-t[1])),a[0][1]<this._squaredPointProximityThreshold(i.pointer))?this._updateSnappingCandidate(a[0][0],r,t,i):this._updateSnappingCandidate(o,r,t,i)}_updateSnappingCandidate(e,t,n,r){this.doneSnapping(),this._currentMainCandidate=e,this._currentSnappedType=t;const i=this._currentMainCandidate.targetPoint,s=[];s.push(...e.hints);for(const o of n){if(e instanceof ye){if(o.constraint.equals(e.first.constraint)||o.constraint.equals(e.second.constraint))continue}else if(o.constraint.equals(e.constraint))continue;const t=o.constraint.closestTo(i);this._squaredScreenDistance(t,i,r.coordinateHelper)<this._squaredSatisfiesConstraintThreshold&&(o.targetPoint=i,this._currentOtherActiveCandidates.push(o),s.push(...o.hints))}return{snappedPoint:i,hints:s}}_squaredPointProximityThreshold(e){return"touch"===e?this._squaredTouchProximityThreshold:this._squaredMouseProximityTreshold}_arePointsWithinScreenThreshold(e,t,n){return this._squaredScreenDistance(e,t,n.coordinateHelper)<this._squaredPointProximityThreshold(n.pointer)}_squaredScreenDistance(e,t,n){return(0,L.Bb)(this._toScreen(e,n),this._toScreen(t,n))}_toScreen(e,t){return(0,H.Rs)(e,t.spatialReference,b.jG,this.view)}_findOldCandidateIndex(e,t){let n=-1;for(let r=0;r<e.length;++r)if(t.constraint.equals(e[r].constraint)){n=r;break}return n}get test(){return{visualizationsActive:this.hasHandles(Se),engines:this._engines}}};var we;(0,a._)([(0,c.Cb)({constructOnly:!0})],me.prototype,"view",void 0),(0,a._)([(0,c.Cb)()],me.prototype,"options",void 0),(0,a._)([(0,c.Cb)({readOnly:!0})],me.prototype,"updating",null),(0,a._)([(0,c.Cb)()],me.prototype,"snappingEnginesFactory",void 0),(0,a._)([(0,c.Cb)()],me.prototype,"_engines",void 0),(0,a._)([(0,c.Cb)()],me.prototype,"_squaredMouseProximityTreshold",null),(0,a._)([(0,c.Cb)()],me.prototype,"_squaredTouchProximityThreshold",null),(0,a._)([(0,c.Cb)()],me.prototype,"_squaredSatisfiesConstraintThreshold",null),me=(0,a._)([(0,d.j)("esri.views.interactive.snapping.SnappingManager")],me),function(e){e[e.MAIN=0]="MAIN",e[e.SCENE=1]="SCENE"}(we||(we={}));const Se="visualization-handle";function Ee(e){let{coordinateHelper:t,elevationInfo:n}=e;return t.hasZ()?b.jG:n}const be=new Map;function xe(e){if(!be.has(e)){const t=function(e,t){var n,r;const i=new g({enabled:!0,selfEnabled:!1,featureEnabled:!0,distance:null!==(n=null===t||void 0===t?void 0:t.distance)&&void 0!==n?n:p.c.distance,touchSensitivityMultiplier:null!==(r=null===t||void 0===t?void 0:t.touchSensitivityMultiplier)&&void 0!==r?r:p.c.touchSensitivityMultiplier});return{...(0,o.YP)((()=>{var t,n;return null!==(t=null===(n=e.map)||void 0===n||null===(n=n.allLayers)||void 0===n?void 0:n.toArray())&&void 0!==t?t:[]}),(e=>{i.featureSources=new s.Z(e.map((e=>new h({layer:e,enabled:!0}))))}),o.nn),options:i}}(e,{distance:10}),n=function(e,t){return new me({view:e,options:t,snappingEnginesFactory:(t,n)=>[new U({view:e,spatialReference:e.spatialReference,options:n})]})}(e,t.options);be.set(e,{referenceCount:0,snappingManager:n,remove:()=>{t.remove(),n.destroy()}})}const t=be.get(e);t.referenceCount++;const n=(0,r.kB)((()=>function(e,t){t.referenceCount--,t.referenceCount>0||(0,i.Y)((()=>{0===t.referenceCount&&(t.remove(),be.delete(e))}))}(e,t)));return{snappingManager:t.snappingManager,...n}}},97760:(e,t,n)=>{n.d(t,{k:()=>a});var r=n(44179),i=n(64674),s=n(75691),o=n(53397);class a extends s.a{constructor(e){super({...e,isDraped:!0,constraint:new r.M8(e.edgeStart,e.edgeEnd,e.getGroundElevation)})}get hints(){return[new o.w(i.ze.REFERENCE,this.constraint.start,this.constraint.end,this.isDraped,this.domain)]}}},95905:(e,t,n)=>{n.d(t,{L:()=>a});var r=n(44179),i=n(64674),s=n(75691),o=n(53397);class a extends s.a{constructor(e){super({...e,constraint:new r.ku(e.edgeStart,e.edgeEnd)})}get hints(){return[new o.w(i.ze.REFERENCE,this.constraint.start,this.constraint.end,this.isDraped,this.domain)]}}},75691:(e,t,n)=>{n.d(t,{a:()=>s});var r=n(80371),i=n(92605);class s extends i.j{constructor(e){let{targetPoint:t,objectId:n,constraint:i,isDraped:s}=e;super(t,i,s,r.B.FEATURE),this.objectId=n}}},92605:(e,t,n)=>{n.d(t,{j:()=>r});class r{constructor(e,t,n,r){this.targetPoint=e,this.constraint=t,this.isDraped=n,this.domain=r}}},55793:(e,t,n)=>{n.d(t,{$7:()=>b,Au:()=>w,CJ:()=>m,Jk:()=>C,Nn:()=>f,SD:()=>u,UG:()=>y,Yf:()=>S,ZE:()=>v,fK:()=>h,hA:()=>x,hm:()=>p,rq:()=>P,sc:()=>_,z9:()=>g,zf:()=>R});var r=n(16889),i=n(88396),s=n(6394),o=n(11186),a=n(71353),l=n(55652),c=n(80064),d=n(94163);function u(e,t,n){let{start:r,end:o,type:a}=e;const l=[],c=(0,i.c)(A,o,r),d=(0,i.c)(j,r,t),u=(0,i.v)(c),h=2*(0,i.g)(c,d),p=h*h-4*u*((0,i.v)(d)-n*n);if(0===p){const e=-h/(2*u);(a===C.PLANE||e>=0)&&l.push((0,i.w)((0,s.a)(),r,c,e))}else if(p>0){const e=Math.sqrt(p),t=(-h+e)/(2*u);(a===C.PLANE||t>=0)&&l.push((0,i.w)((0,s.a)(),r,c,t));const n=(-h-e)/(2*u);(a===C.PLANE||n>=0)&&l.push((0,i.w)((0,s.a)(),r,c,n))}return l}function h(e,t){const n=e.start,r=e.end,s=(0,i.c)(A,r,n),l=(0,o.s)(j,-s[1],s[0],0),c=t.start,u=t.end,h=(0,o.u)(F,u,c),p=(0,o.j)(h,l),f=(0,o.s)(G,n[0],n[1],0),g=(0,o.u)(I,f,c),_=(0,o.j)(g,l);if(Math.abs(p)<D)return Math.abs(_),[];const v=(0,o.q)(M,c,h,_/p);if(t.type===d.SP.RAY){const e=(0,o.u)(N,v,c);if((0,o.j)(e,h)<-D)return[]}if(e.type===C.HALF_PLANE){const e=(0,i.b)(N,v,n);if((0,i.g)(e,s)<-D)return[]}return[(0,a.g)(v)]}function p(e,t){return function(e,t){let{start:n,end:r,type:i}=e;const s=(0,o.u)(A,t,n),l=(0,o.u)(j,r,n),c=(0,o.b)(F,l,s);if((0,o.F)(c)/(0,o.F)(l)<D)switch(i){case d.SP.LINE:return[(0,a.g)(t)];case d.SP.RAY:return(0,o.j)(l,s)<-D?[]:[(0,a.g)(t)]}return[]}(E(z,t[2],e),t)}function f(e,t){const n=w(E(z,0,e),E(k,0,t)),r=[];for(const i of n)r.push((0,s.d)(i));return r}function g(e,t){return v(e,E(z,e[2],t))}function _(e,t,n){const r=(0,i.c)(A,e,t),s=n/(0,i.h)(r),o=(0,i.w)((0,a.c)(),t,r,s);return o[2]=e[2],o}function v(e,t){let{start:n,end:r,type:i}=t;const s=(0,o.u)(A,e,n),l=(0,o.u)(j,r,n),c=(0,o.j)(s,l)/(0,o.j)(l,l);return(0,o.q)((0,a.c)(),n,l,i===d.SP.RAY?Math.max(c,0):c)}const y=(()=>{const e=(0,a.c)(),t=(0,a.c)(),n=(0,a.c)();return(r,u)=>{let{start:h,end:p}=r,{center:f,radius:g,normal:_,slicePlane:v}=u;const y=(0,a.c)(),m=(0,l.Yq)(f,_,V);if(x((0,l.TE)(m,h),0)&&x((0,l.TE)(m,p),0)){(0,c._F)(_,e,t);const r=(r,s)=>((0,o.f)(n,s,f),(0,i.s)(r,(0,o.j)(n,e),(0,o.j)(n,t)),r),l=(0,d.UG)({start:r(O,h),end:r(L,p),type:d.SP.LINE},s.Z,g),u=[];for(const[n,i]of l){const r=(0,o.c)((0,a.c)(),f);(0,o.q)(r,r,e,n),(0,o.q)(r,r,t,i),v&&!R(v,r)||u.push(r)}return u}return(0,l.fn)(m,h,p,y)?!x((0,o.o)(y,f),g)||v&&!R(v,y)?[]:[y]:[]}})();function m(e,t,n){let{start:r,end:s,type:l}=e;const c=[],u=(0,o.f)(A,s,r),h=(0,i.c)(j,r,t),p=(0,i.v)(u),f=2*(0,i.g)(u,h),g=f*f-4*p*((0,i.v)(h)-n*n);if(0===g){const e=-f/(2*p);(l===d.SP.LINE||e>=0)&&c.push((0,o.q)((0,a.c)(),r,u,e))}else if(g>0){const e=Math.sqrt(g),t=(-f+e)/(2*p);(l===d.SP.LINE||t>=0)&&c.push((0,o.q)((0,a.c)(),r,u,t));const n=(-f-e)/(2*p);(l===d.SP.LINE||n>=0)&&c.push((0,o.q)((0,a.c)(),r,u,n))}return c}function w(e,t){const n=e.start,i=e.end,s=t.start,l=t.end,c=(0,o.u)(A,i,n),u=(0,o.u)(j,l,s),h=(0,o.u)(F,s,n),p=(0,o.b)(G,c,u),f=(0,o.j)(h,p);if(!(0,r.W8)(f,0,D))return[];const g=(0,o.F)(p);if((0,r.W8)(g,0,D))return[];const _=(0,o.b)(I,h,u),v=(0,o.j)(_,p)/g,y=(0,o.q)(M,n,c,v);if(e.type===d.SP.RAY){const e=(0,o.u)(N,y,n);if((0,o.j)(c,e)<-D)return[]}if(t.type===d.SP.RAY){const e=(0,o.u)(N,y,s);if((0,o.j)(u,e)<-D)return[]}return[(0,a.g)(y)]}function S(e,t,n,r){const[o,a]=e,[l,c]=n,d=l-o,u=c-a,h=d*d+u*u,p=Math.sqrt(h);if(p>t+r)return[];if(p<Math.abs(t-r))return[];if(x(p,0)&&x(t,r))return[];const f=(t*t-r*r+h)/(2*p),g=Math.sqrt(t*t-f*f),_=g*u/p,v=g*d/p,[y,m]=(0,i.l)(O,e,n,f/p);return x(_,v)?[(0,s.f)(y,m)]:[(0,s.f)(y+_,m-v),(0,s.f)(y-_,m+v)]}function E(e,t,n){let{start:r,end:i,type:s}=n;return(0,o.s)(e.start,r[0],r[1],t),(0,o.s)(e.end,i[0],i[1],t),e.type=T[s],e}function b(e,t){return x(e[2],t[2])}function x(e,t){return Math.abs(e-t)<D}function P(e,t){return t.filter((t=>R(e,t)))}function R(e,t){return(0,l.Ac)(e,t)}var C;!function(e){e[e.PLANE=0]="PLANE",e[e.HALF_PLANE=1]="HALF_PLANE"}(C||(C={}));const T={[C.PLANE]:d.SP.LINE,[C.HALF_PLANE]:d.SP.RAY},D=1e-6,O=(0,s.a)(),L=(0,s.a)(),A=(0,a.c)(),j=(0,a.c)(),F=(0,a.c)(),G=(0,a.c)(),I=(0,a.c)(),M=(0,a.c)(),N=(0,a.c)(),V=(0,l.Ue)(),z={start:(0,a.c)(),end:(0,a.c)(),type:d.SP.LINE},k={start:(0,a.c)(),end:(0,a.c)(),type:d.SP.LINE}}}]);
//# sourceMappingURL=3130.47006662.chunk.js.map